---
const projects = [
  {
    name: "Converting chess ratings between different systems",
    url: "https://chessratings.org/",
    description: "Chessratings.org allows the conversion of chess ratings between different systems. This is achieved using custom built linear regression models. A complete write-up of the methods used is included, which I believe contributes to user confidence rather than simply providing a black box.",
    color: "var(--ctp-lavender)",
  },
  {
    name: "Tracking the purity of illicit drug markets",
    url: "https://drugstats.net/",
    description: "An aggregation of test results from the US drug testing service drugsdata.org to gain insights into illicit drug markets over time. Also, an analysis of the emotions present in experience reports from erowid.",
    color: "var(--ctp-peach)",
  },
  {
    name: "Reddit moderation bot",
    url: "https://www.reddit.com/user/LittleTyrantDuckBot/",
    description: "I run the animal tracking subreddit (r/AnimalTracking). It has grown into a large and active community with over 170k members. This bot interfaces with a large language model to help enforce the rules, and take some load off the moderation team. Using this bot, I believe I have struck a good balance between automation, and real human engagement. Without this bot we would not be able to moderate this community to the standard that we do.",
    color: "var(--ctp-sky)",
  },
  {
    name: "The great eye",
    description: "After visiting the strange and wimsical world of the Denver Meow Wolf: Convergence Station (which I could not recommend enough), I was struck by the inspiration to make something physical. This eye was cut out of wood and laser engraved. The iris and pupil are a seperate piece of wood painted by hand, then suspended by thread which is reeled in and out by two stepper motors to control its position.",
    content: [
      { type: "text", value: "In this video I hadn't yet programmed in the bounds of the eye, which is why it moves so far to the side:" },
      { type: "video", value: "videos/eye1.mp4" },
      { type: "text", value: "Here it is later mounted on my camper at a music festival:" },
      { type: "video", value: "videos/eye2.mp4" },
      { type: "text", value: "This project was a great excuse to learn about microcontrollers, robotics, and to dip a toe into electrical engineering. It was also nice to make something that exists in the physical world, as the vast majority of my work lives entirely in abstraction. In a future iteration I would love to make it track faces!" }
    ],
    color: "var(--ctp-maroon)",
  }
];
---

<section class="project">
  <div class="content">
    <h2 class="section-title">Featured Projects</h2>
    <div class="projects">
      {
        projects.map((project, index) => (
          <div class="project-item">
            <button
              class="project-header"
              aria-expanded="false"
              aria-controls={`project-content-${index}`}
              style={`--project-color: ${project.color}`}
            >
              <span class="project-icon">â—ˆ</span>
              <span class="project-name">{project.name}</span>
              <svg class="project-chevron" viewBox="0 0 24 24" fill="none">
                <path
                  d="M6 9l6 6 6-6"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </button>
            <div class="project-content" id={`project-content-${index}`}>
              {project.description && (
                <p class="project-description">{project.description}</p>
              )}
              {
                project.content && project.content.length > 0 && (
                  <div class="project-rich-content">
                    {project.content.map((item, itemIndex) => (
                      item.type === "text" ? (
                        <p class="project-text">{item.value}</p>
                      ) : item.type === "video" ? (
                        <div class="project-video">
                          <video
                            controls
                            preload="metadata"
                            title={`${project.name} video ${itemIndex + 1}`}
                          >
                            <source src={item.value} type="video/mp4" />
                            Your browser doesn't support video playback.
                          </video>
                        </div>
                      ) : null
                    ))}
                  </div>
                )
              }
              {
                project.url && (
                  <a
                    href={project.url}
                    class="project-link"
                    target="_blank"
                    rel="noopener noreferrer"
                    style={`--project-color: ${project.color}`}
                  >
                    Visit Project
                    <svg class="project-arrow" viewBox="0 0 24 24" fill="none">
                      <path
                        d="M7 17L17 7M17 7H7M17 7V17"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </a>
                )
              }
            </div>
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const headers = document.querySelectorAll('.project-header');
    
    headers.forEach(header => {
      header.addEventListener('click', () => {
        const isExpanded = header.getAttribute('aria-expanded') === 'true';
        const content = header.nextElementSibling as HTMLElement;
        
        // Close all other accordions
        headers.forEach(otherHeader => {
          if (otherHeader !== header) {
            otherHeader.setAttribute('aria-expanded', 'false');
            const otherContent = otherHeader.nextElementSibling as HTMLElement;
            otherContent.style.maxHeight = '0';
          }
        });
        
        // Toggle current accordion
        header.setAttribute('aria-expanded', (!isExpanded).toString());
        
        if (!isExpanded) {
          content.style.maxHeight = content.scrollHeight + 'px';
        } else {
          content.style.maxHeight = '0';
        }
      });
    });
  });
</script>

<style>
  .project {
    padding: 6rem 2rem;
    display: flex;
    justify-content: center;
  }

  .content {
    max-width: 600px;
    width: 100%;
  }

  .section-title {
    font-size: 2rem;
    font-weight: 600;
    color: var(--ctp-text);
    margin-bottom: 3rem;
    text-align: center;
  }

  .projects {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .project-item {
    background-color: var(--ctp-surface0);
    border: 2px solid var(--project-color);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .project-header {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem 2rem;
    background-color: transparent;
    border: none;
    color: var(--ctp-text);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
  }

  .project-header:hover {
    background-color: var(--ctp-surface1);
  }

  .project-icon {
    font-size: 1.5rem;
    color: var(--project-color);
    transition: all 0.3s ease;
  }

  .project-name {
    flex: 1;
    font-size: 1.25rem;
    font-weight: 500;
    transition: color 0.3s ease;
  }

  .project-chevron {
    width: 24px;
    height: 24px;
    color: var(--project-color);
    transition: transform 0.3s ease;
  }

  .project-header[aria-expanded="true"] .project-chevron {
    transform: rotate(180deg);
  }

  .project-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .project-description {
    padding: 0 2rem 1.5rem 2rem;
    color: var(--ctp-subtext0);
    line-height: 1.6;
    margin: 0;
  }

  .project-rich-content {
    padding: 0 2rem 1.5rem 2rem;
  }

  .project-text {
    color: var(--ctp-subtext0);
    line-height: 1.6;
    margin: 0 0 1rem 0;
  }

  .project-rich-content .project-video {
    margin: 1rem 0;
  }

  .project-videos {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 0 2rem 1.5rem 2rem;
  }

  .project-video {
    position: relative;
    padding-bottom: 75%; /* 4:3 aspect ratio */
    height: 0;
    overflow: hidden;
    border-radius: 8px;
    background-color: var(--ctp-surface1);
  }

  .project-video iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
  }

  .project-video video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 8px;
    object-fit: contain;
  }

  .project-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0 2rem 1.5rem 2rem;
    padding: 0.75rem 1.5rem;
    background-color: var(--project-color);
    color: var(--ctp-base);
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .project-link:hover {
    transform: translateX(4px);
    opacity: 0.9;
  }

  .project-arrow {
    width: 20px;
    height: 20px;
    transition: transform 0.3s ease;
  }

  .project-link:hover .project-arrow {
    transform: translate(2px, -2px);
  }

  @media (max-width: 600px) {
    .project {
      padding: 4rem 2rem;
    }

    .section-title {
      font-size: 1.5rem;
      margin-bottom: 2rem;
    }

    .project-header {
      padding: 1.25rem 1.5rem;
    }

    .project-name {
      font-size: 1.1rem;
    }

    .project-description {
      padding: 0 1.5rem 1.25rem 1.5rem;
      font-size: 0.95rem;
    }

    .project-rich-content {
      padding: 0 1.5rem 1.25rem 1.5rem;
    }

    .project-text {
      font-size: 0.95rem;
    }

    .project-videos {
      padding: 0 1.5rem 1.25rem 1.5rem;
    }

    .project-link {
      margin: 0 1.5rem 1.25rem 1.5rem;
      padding: 0.65rem 1.25rem;
      font-size: 0.9rem;
    }
  }
</style>
